<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Integration with ASP.Net Core | Lamar</title>
    <meta name="description" content=".NET Fast Inversion of Control and Dynamic code weaving tools">
    <link rel="stylesheet" href="/lamar/assets/style.5189d035.css">
    <link rel="modulepreload" href="/lamar/assets/Home.48453dc5.js">
    <link rel="modulepreload" href="/lamar/assets/AlgoliaSearchBox.3ea63e75.js">
    <link rel="modulepreload" href="/lamar/assets/app.21b67795.js">
    <link rel="modulepreload" href="/lamar/assets/guide_ioc_aspnetcore.md.5455d959.lean.js">
    <link rel="modulepreload" href="/lamar/assets/app.21b67795.js">
    <meta name="twitter:title" content="Integration with ASP.Net Core | Lamar">
    <meta property="og:title" content="Integration with ASP.Net Core | Lamar">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-7161a24b><div class="sidebar-button" data-v-7161a24b><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/lamar/" aria-label="Lamar, back to home" data-v-7161a24b data-v-4a583abe><!----> Lamar</a><div class="flex-grow" data-v-7161a24b></div><div class="nav" data-v-7161a24b><nav class="nav-links" data-v-7161a24b data-v-15acbf05><!--[--><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-641633f9><a class="item" href="/lamar/guide/" data-v-641633f9>Guide <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-641633f9><a class="item isExternal" href="https://github.com/JasperFx/lamar/releases" target="_blank" rel="noopener noreferrer" data-v-641633f9>Release Notes <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-641633f9><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-641633f9><a class="item isExternal" href="https://gitter.im/JasperFx/lamar?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge" target="_blank" rel="noopener noreferrer" data-v-641633f9>Gitter | Join Chat <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-641633f9><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-641633f9><a class="item isExternal" href="https://github.com/JasperFx/lamar" target="_blank" rel="noopener noreferrer" data-v-641633f9>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-641633f9><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav></div><!--[--><!--[--><div class="algolia-search-box" id="docsearch"></div><!--]--><!--]--></header><aside class="sidebar" data-v-6b49cdcd><nav class="nav-links nav" data-v-6b49cdcd data-v-15acbf05><!--[--><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-641633f9><a class="item" href="/lamar/guide/" data-v-641633f9>Guide <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-641633f9><a class="item isExternal" href="https://github.com/JasperFx/lamar/releases" target="_blank" rel="noopener noreferrer" data-v-641633f9>Release Notes <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-641633f9><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-641633f9><a class="item isExternal" href="https://gitter.im/JasperFx/lamar?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge" target="_blank" rel="noopener noreferrer" data-v-641633f9>Gitter | Join Chat <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-641633f9><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-641633f9><a class="item isExternal" href="https://github.com/JasperFx/lamar" target="_blank" rel="noopener noreferrer" data-v-641633f9>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-641633f9><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-6b49cdcd><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/">Getting Started</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/">Inversion of Control</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/concepts">Software Design Concepts</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/bootstrapping">Bootstrapping a Container</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/lamar/guide/ioc/aspnetcore">Integration with ASP.NET Core</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#asp-net-core-v3">ASP.Net Core v3.*</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#worker-service-core-v3">Worker Service Core v3.*</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#extended-command-line-diagnostics-for-asp-net-core">Extended Command Line Diagnostics for ASP.Net Core</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#lamar-services">lamar-services</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#lamar-scanning">lamar-scanning</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#lamar-validate">lamar-validate</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#adding-lamar-environment-checks">Adding Lamar Environment Checks</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/blazor">Integration with Blazor</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/registration/">Registration</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/registration/registry-dsl">ServiceRegistry DSL</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/registration/inline-dependencies">Inline Dependencies</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/registration/auto-registration-and-conventions">Auto-Registration and Conventions</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/registration/configured-instance">Working with IConfiguredInstance</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/registration/policies">Policies</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/registration/changing-configuration-at-runtime">Changing Configuration at Runtime</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/registration/constructor-selection">Constructor Selection</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/registration/existing-objects">Registering Existing Objects</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/registration/attributes">Using Attributes for Configuration</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/registration/overrides">Overriding Service Registrations</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/lifetime">Service Lifetimes</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/resolving/">Resolving Services</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/resolving/get-a-service-by-service-type">Get a Service by Service Type</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/resolving/get-a-service-by-service-type-and-name">Get a Service by Service Type and Name</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/resolving/get-all-services-by-service-type">Get all Services by Service Type</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/resolving/try-getting-an-optional-service-by-service-type">Try Getting an Optional Service by Service Type</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/resolving/try-getting-an-optional-service-by-service-type-and-name">Try Getting an Optional Service by Service Type and Name</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/resolving/requesting-a-concrete-type">Auto Resolving Concrete Types</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/generics">Generic Types</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/decorators">Decorators, Interceptors, and Activators</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/diagnostics/">Lamar Diagnostics</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/diagnostics/what-do-i-have">WhatDoIHave()</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/diagnostics/validating-container-configuration">Validating Container Configuration</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/diagnostics/environment-tests">Environment Tests</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/diagnostics/build-plans">Build Plans</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/diagnostics/using-the-container-model">Using the Container Model</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/diagnostics/type-scanning">Type Scanning Diagnostics</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/auto-wiring">Auto Wiring</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/lambdas">Building Objects with Lambdas</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/injecting-at-runtime">Injecting Services at Runtime</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/disposing">Lamar and IDisposable</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/lazy-resolution">Lazy Resolution</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/nested-containers">Nested Containers (Per Request/Transaction)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/setter-injection">Setter Injection</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/working-with-enumerable-types">Working with Enumerable Types</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/compilation/">Compilation</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/compilation/assembly-generator">Compiling code with AssemblyGenerator</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/compilation/source-writer">Generating code with ISourceWriter</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/compilation/frames/">The &quot;Frame&quot; Model</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/compilation/frames/variables">Working with Variables</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/compilation/frames/frame">Building custom Frames</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/compilation/frames/extension-methods">Extension methods for Names in code</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/compilation/frames/injected-fields">Injected Fields</a><!----></li></ul></li></ul></li><!--]--></ul><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h1 id="integration-with-asp-net-core"><a class="header-anchor" href="#integration-with-asp-net-core" aria-hidden="true">#</a> Integration with <a href="http://ASP.Net" target="_blank" rel="noopener noreferrer">ASP.Net</a> Core</h1><div class="tip custom-block"><p class="custom-block-title">INFO</p><p>As of Lamar.Microsoft.DependencyInjection 4.0, Lamar successfully support .Net Core 3 and <a href="http://ASP.Net" target="_blank" rel="noopener noreferrer">ASP.Net</a> Core 3.0.</p></div><p>To use Lamar within <a href="http://ASP.Net" target="_blank" rel="noopener noreferrer">ASP.Net</a> Core applications, also install the <a href="https://www.nuget.org/packages/Lamar.Microsoft.DependencyInjection/" target="_blank" rel="noopener noreferrer">Lamar.Microsoft.DependencyInjection</a> library from NuGet to your <a href="http://ASP.Net" target="_blank" rel="noopener noreferrer">ASP.Net</a> Core project (and you can thank Microsoft for the clumsy naming convention, thank you).</p><p>With that NuGet installed, your normal <a href="http://ASP.Net" target="_blank" rel="noopener noreferrer">ASP.Net</a> Core bootstrapping changes just slightly. When you bootstrap your <code>IWebHostBuilder</code> object that configures <a href="http://ASP.Net" target="_blank" rel="noopener noreferrer">ASP.Net</a> Core, you also need to call the <code>UseLamar()</code> method as shown below:</p><!-- snippet: sample_getting-started-main --><p><a id="snippet-sample_getting-started-main"></a></p><div class="language-cs"><pre><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WebHostBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    builder
        <span class="token comment">// Replaces the built in DI container</span>
        <span class="token comment">// with Lamar</span>
        <span class="token punctuation">.</span><span class="token function">UseLamar</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment">// Normal ASP.Net Core bootstrapping</span>
        <span class="token punctuation">.</span><span class="token function">UseUrls</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:5002&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">UseKestrel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">UseStartup</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Startup<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    builder<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/lamar/blob/master/src/Lamar.AspNetCoreTests/Samples/StartUp.cs#L14-L31" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_getting-started-main" title="Start of snippet">anchor</a></sup><!-- endSnippet --></p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>The <code>Startup.ConfigureServices(ServiceRegistry)</code> convention does not work as of <a href="http://ASP.Net" target="_blank" rel="noopener noreferrer">ASP.Net</a> Core 2.1. Use <code>ConfigureContainer(ServiceRegistry)</code> instead.</p></div><p>If you use a <code>StartUp</code> class for extra configuration, your <code>ConfigureContainer()</code> method <em>can</em> take in a <code>ServiceRegistry</code> object from Lamar for service registrations in place of the <a href="http://ASP.Net" target="_blank" rel="noopener noreferrer">ASP.Net</a> Core <code>IServiceCollection</code> interface as shown below:</p><!-- snippet: sample_getting-started-startup --><p><a id="snippet-sample_getting-started-startup"></a></p><div class="language-cs"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Startup</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Take in Lamar&#39;s ServiceRegistry instead of IServiceCollection</span>
    <span class="token comment">// as your argument, but fear not, it implements IServiceCollection</span>
    <span class="token comment">// as well</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureContainer</span><span class="token punctuation">(</span><span class="token class-name">ServiceRegistry</span> services<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Supports ASP.Net Core DI abstractions</span>
        services<span class="token punctuation">.</span><span class="token function">AddMvc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        services<span class="token punctuation">.</span><span class="token function">AddLogging</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// Also exposes Lamar specific registrations</span>
        <span class="token comment">// and functionality</span>
        services<span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
            s<span class="token punctuation">.</span><span class="token function">TheCallingAssembly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            s<span class="token punctuation">.</span><span class="token function">WithDefaultConventions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IApplicationBuilder</span> app<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        app<span class="token punctuation">.</span><span class="token function">UseMvc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/lamar/blob/master/src/Lamar.AspNetCoreTests/Samples/StartUp.cs#L35-L61" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_getting-started-startup" title="Start of snippet">anchor</a></sup><!-- endSnippet --></p><p>You can also still write <code>ConfigureServices(IServiceCollection)</code>, but you&#39;d miss out on most of Lamar&#39;s extra functionality beyond what that abstraction provides.</p><p>And that is that, you&#39;re ready to run your <a href="http://ASP.Net" target="_blank" rel="noopener noreferrer">ASP.Net</a> Core application with Lamar handling service resolution and object cleanup during your HTTP requests.</p><h2 id="asp-net-core-v3"><a class="header-anchor" href="#asp-net-core-v3" aria-hidden="true">#</a> <a href="http://ASP.Net" target="_blank" rel="noopener noreferrer">ASP.Net</a> Core v3.*</h2><p>The set up with <a href="http://ASP.Net" target="_blank" rel="noopener noreferrer">ASP.Net</a> Core v3 isn&#39;t really any different, but there&#39;s a known <em>gotcha</em> with the <code>AddControllers()</code> call as shown below:</p><!-- snippet: sample_integration-with-mvc3 --><p><a id="snippet-sample_integration-with-mvc3"></a></p><div class="language-cs"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">CreateHostBuilder</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">IHostBuilder</span> <span class="token function">CreateHostBuilder</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        Host<span class="token punctuation">.</span><span class="token function">CreateDefaultBuilder</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>
            
            <span class="token comment">// Add Lamar</span>
            <span class="token punctuation">.</span><span class="token function">UseLamar</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            
            
            <span class="token punctuation">.</span><span class="token function">ConfigureWebHostDefaults</span><span class="token punctuation">(</span>webBuilder <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                webBuilder<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">UseStartup</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Startup<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                webBuilder<span class="token punctuation">.</span><span class="token function">ConfigureServices</span><span class="token punctuation">(</span>services <span class="token operator">=&gt;</span>
                <span class="token punctuation">{</span>
                    <span class="token comment">// This is important, the call to AddControllers()</span>
                    <span class="token comment">// cannot be made before the usage of ConfigureWebHostDefaults</span>
                    services<span class="token punctuation">.</span><span class="token function">AddControllers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/lamar/blob/master/src/LamarWithAspNetCoreMvc3/Program.cs#L14-L42" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_integration-with-mvc3" title="Start of snippet">anchor</a></sup><!-- endSnippet --></p><p>To play it safe, add any registrations or configuration directly related to MVC Core directly within or after the call to <code>IHostBuilder.ConfigureWebHostDefaults()</code>. This is strictly an issue with ordering within MVC Core guts, and not particularly a problem with Lamar per se.</p><h2 id="worker-service-core-v3"><a class="header-anchor" href="#worker-service-core-v3" aria-hidden="true">#</a> Worker Service Core v3.*</h2><p>To set up for a worker service, you&#39;ll use the same ConfigureContainer() albeit with a different signature.</p><!-- snippet: sample_startup-worker-service --><p><a id="snippet-sample_startup-worker-service"></a></p><div class="language-cs"><pre><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">IHostBuilder</span> <span class="token function">CreateHostBuilder</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
	Host<span class="token punctuation">.</span><span class="token function">CreateDefaultBuilder</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">UseLamar</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token punctuation">(</span>hostContext<span class="token punctuation">,</span> services<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
		<span class="token punctuation">{</span>
			services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddHostedService</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Worker<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ConfigureContainer</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Lamar<span class="token punctuation">.</span>ServiceRegistry<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> services<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
		<span class="token punctuation">{</span>
			<span class="token comment">// Also exposes Lamar specific registrations</span>
			<span class="token comment">// and functionality</span>
			services<span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span>
			<span class="token punctuation">{</span>
				s<span class="token punctuation">.</span><span class="token function">TheCallingAssembly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				s<span class="token punctuation">.</span><span class="token function">WithDefaultConventions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/lamar/blob/master/src/SampleWorkerApp/Program.cs#L18-L36" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_startup-worker-service" title="Start of snippet">anchor</a></sup><!-- endSnippet --></p><h2 id="extended-command-line-diagnostics-for-asp-net-core"><a class="header-anchor" href="#extended-command-line-diagnostics-for-asp-net-core" aria-hidden="true">#</a> Extended Command Line Diagnostics for <a href="http://ASP.Net" target="_blank" rel="noopener noreferrer">ASP.Net</a> Core</h2><div class="tip custom-block"><p class="custom-block-title">INFO</p><p>If you are targeting .Net Core 3.0 and/or <code>netstandard2.1</code>, use the newly consolidated <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/host/generic-host?view=aspnetcore-3.0" target="_blank" rel="noopener noreferrer">HostBuilder</a> instead of the previous <code>IWebHostBuilder</code>.</p></div><p>New with the Lamar 3.1.0 release is a separate Nuget package named <em>Lamar.Diagnostics</em> that can be used to add easy access to the <a href="/guide/ioc/diagnostics/">Lamar diagnostics</a> for your <a href="http://ASP.Net" target="_blank" rel="noopener noreferrer">ASP.Net</a> Core application from the command line.</p><p>First, you need to be using the <a href="https://jasperfx.github.io/oakton/documentation/aspnetcore/" target="_blank" rel="noopener noreferrer">Oakton.AspNetCore</a> package to execute commands in your <a href="http://ASP.Net" target="_blank" rel="noopener noreferrer">ASP.Net</a> Core application like this:</p><!-- snippet: sample_using-oakton-aspnetcore --><p><a id="snippet-sample_using-oakton-aspnetcore"></a></p><div class="language-cs"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> registry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ServiceRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
registry<span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    x<span class="token punctuation">.</span><span class="token function">Assembly</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Program</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Assembly<span class="token punctuation">)</span><span class="token punctuation">;</span>
    x<span class="token punctuation">.</span><span class="token function">WithDefaultConventions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HostBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> builder
    <span class="token comment">// Replaces the built in DI container</span>
    <span class="token comment">// with Lamar</span>
    <span class="token punctuation">.</span><span class="token function">UseLamar</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">ConfigureWebHostDefaults</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Normal ASP.Net Core bootstrapping</span>
        x<span class="token punctuation">.</span><span class="token function">UseUrls</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:5002&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">UseKestrel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">UseStartup</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Startup<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token punctuation">.</span><span class="token function">RunOaktonCommands</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/lamar/blob/master/src/SampleWebApp/Program.cs#L22-L46" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_using-oakton-aspnetcore" title="Start of snippet">anchor</a></sup><!-- endSnippet --></p><p>Including this <em>Lamar.Diagnostics</em> NuGet into your <a href="http://ASP.Net" target="_blank" rel="noopener noreferrer">ASP.Net</a> Core application will add some additional Lamar diagnostic commands. If you open a command line tool to the root directory of your <a href="http://ASP.Net" target="_blank" rel="noopener noreferrer">ASP.Net</a> Core project with the <em>Lamar.Diagnostics</em> and <em>Oakton.AspNetCore</em> NuGet installed and type the command for CLI usage <code>dotnet run -- ?</code> or <code>dotnet run -- help</code>, you&#39;ll get something like this:</p><div class="language-bash"><pre><code>Searching <span class="token string">&#39;Lamar.Diagnostics, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null&#39;</span> <span class="token keyword">for</span> commands

  -----------------------------------------------------------------------------------
    Available commands:
  -----------------------------------------------------------------------------------
         check-env -<span class="token operator">&gt;</span> Execute all environment checks against the application
    lamar-scanning -<span class="token operator">&gt;</span> Runs Lamar&#39;s <span class="token builtin class-name">type</span> scanning diagnostics
    lamar-services -<span class="token operator">&gt;</span> List all the registered Lamar services
    lamar-validate -<span class="token operator">&gt;</span> Runs all the Lamar container validations
               run -<span class="token operator">&gt;</span> Runs the configured AspNetCore application
  -----------------------------------------------------------------------------------
</code></pre></div><p>As you can see, there are three additional commands specific for the <a href="/guide/ioc/diagnostics/">built in Lamar diagnostics</a>. All of these commands support the <a href="https://jasperfx.github.io/oakton/documentation/aspnetcore/" target="_blank" rel="noopener noreferrer">Oakton.AspNetCore</a> flags for overriding the <a href="http://ASP.Net" target="_blank" rel="noopener noreferrer">ASP.Net</a> Core hosting environment name, configuration settings, and default log level.</p><div class="tip custom-block"><p class="custom-block-title">INFO</p><p>When all of these commands execute, they <em>do</em> build the underlying <code>IWebHost</code> for your application, but they do <strong>not</strong> start the Kestrel server or run any of your application <code>IHostedService</code> registrations. Your application will be torn down and disposed as part of the command execution as well.</p></div><h2 id="lamar-services"><a class="header-anchor" href="#lamar-services" aria-hidden="true">#</a> lamar-services</h2><p>This command displays the output of Lamar&#39;s <a href="/guide/ioc/diagnostics/what-do-i-have.html">WhatDoIHave()</a> function against the underlying Lamar container of the configured <a href="http://ASP.Net" target="_blank" rel="noopener noreferrer">ASP.Net</a> Core application. The basic usage is <code>dotnet run -- lamar-services</code>.</p><p>The full usage is shown below:</p><div class="language-bash"><pre><code> Usages <span class="token keyword">for</span> <span class="token string">&#39;lamar-services&#39;</span> <span class="token punctuation">(</span>List all the registered Lamar services<span class="token punctuation">)</span>
  lamar-services <span class="token punctuation">[</span>-f, --file <span class="token operator">&lt;</span>file<span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>-n, --namespace <span class="token operator">&lt;</span>namespace<span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>-a, --assembly <span class="token operator">&lt;</span>assembly<span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>-t, --type <span class="token operator">&lt;</span>type<span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>-b, --build-plans<span class="token punctuation">]</span> <span class="token punctuation">[</span>-e, --environment <span class="token operator">&lt;</span>environment<span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>-v, --verbose<span class="token punctuation">]</span> <span class="token punctuation">[</span>-l, --log-level <span class="token operator">&lt;</span>logleve<span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>----config:<span class="token operator">&lt;</span>prop<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token punctuation">]</span>

  ----------------------------------------------------------------------------------------------------------------------------------------
    Flags
  ----------------------------------------------------------------------------------------------------------------------------------------
                  <span class="token punctuation">[</span>-f, --file <span class="token operator">&lt;</span>file<span class="token operator">&gt;</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Optional <span class="token function">file</span> to <span class="token function">write</span> the results
        <span class="token punctuation">[</span>-n, --namespace <span class="token operator">&lt;</span>namespace<span class="token operator">&gt;</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Optionally filter the results to only types <span class="token keyword">in</span> this namespace
          <span class="token punctuation">[</span>-a, --assembly <span class="token operator">&lt;</span>assembly<span class="token operator">&gt;</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Optionally filter the results to only types <span class="token keyword">in</span> this assembly
                  <span class="token punctuation">[</span>-t, --type <span class="token operator">&lt;</span>type<span class="token operator">&gt;</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Optionally filter the results to only this named type. Can be either a <span class="token builtin class-name">type</span> name or a full name
                  <span class="token punctuation">[</span>-b, --build-plans<span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Show the full build plans
    <span class="token punctuation">[</span>-e, --environment <span class="token operator">&lt;</span>environment<span class="token operator">&gt;</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Use to override the ASP.Net Environment name
                      <span class="token punctuation">[</span>-v, --verbose<span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Write out much <span class="token function">more</span> information at startup and enables console logging
          <span class="token punctuation">[</span>-l, --log-level <span class="token operator">&lt;</span>logleve<span class="token operator">&gt;</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Override the log level
          <span class="token punctuation">[</span>----config:<span class="token operator">&lt;</span>prop<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Overwrite individual configuration items
  ----------------------------------------------------------------------------------------------------------------------------------------
</code></pre></div><p>The output can be filtered by using the <code>--namespace [namespace name]</code> or <code>--assembly [assembly name]</code> flags if you&#39;re only looking for certain registrations. The <code>--type [type name]</code> flag can help you look for specific types. This flag can either match against a type&#39;s full name or just the type name and looks for both service types and implementation types.</p><p>You can write the results to a text file instead by specifying a file location with the <code>--file [file name]</code> flag.</p><p>Lastly, you can instead write out the [build plans]/guide/ioc/diagnostics/build-plans) with the same filtering options using the <code>--build-plans</code> flag.</p><h2 id="lamar-scanning"><a class="header-anchor" href="#lamar-scanning" aria-hidden="true">#</a> lamar-scanning</h2><p>The <code>lamar-scanning</code> command gives you quick access to the <a href="/guide/ioc/diagnostics/type-scanning.html">type scanning diagnostics</a> functionality in Lamar.</p><p>Using the command <code>dotnet run -- lamar-scanning</code> command on the sample application shown earlier in this page results in this output:</p><div class="language-bash"><pre><code>Searching <span class="token string">&#39;Lamar.Diagnostics, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null&#39;</span> <span class="token keyword">for</span> commands
All Scanners
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>

Assemblies
----------
* SampleWebApp, <span class="token assign-left variable">Version</span><span class="token operator">=</span><span class="token number">1.0</span>.0.0, <span class="token assign-left variable">Culture</span><span class="token operator">=</span>neutral, <span class="token assign-left variable">PublicKeyToken</span><span class="token operator">=</span>null

Conventions
--------
* Default I<span class="token punctuation">[</span>Name<span class="token punctuation">]</span>/<span class="token punctuation">[</span>Name<span class="token punctuation">]</span> registration convention


No problems were encountered <span class="token keyword">in</span> exporting types from Assemblies
</code></pre></div><p>Any type scanning errors detected during application bootstrapping will be shown in the output. If there are any errors, this command will fail by returning a non-zero return code. You could use this command as part of your continuous integration process to catch any kind of assembly loading problems found in type scanning.</p><h2 id="lamar-validate"><a class="header-anchor" href="#lamar-validate" aria-hidden="true">#</a> lamar-validate</h2><p>The <code>lamar-validate</code> command will build your <a href="http://ASP.Net" target="_blank" rel="noopener noreferrer">ASP.Net</a> Core application (the <code>IWebHost</code>), then use Lamar&#39;s <a href="/guide/ioc/diagnostics/validating-container-configuration.html">built in container validation</a> to verify that the container can successfully build all known registrations. All validation errors will be reported, and the command will fail if there are any errors detected. This command can be used in continuous integration builds as another type of check on the system.</p><p>In its default usage, <code>dotnet run -- lamar-validate</code> will only validate the container configuration. If you use the <code>dotnet run -- lamar-validate Full</code> usage, the command will also execute any Lamar <a href="/guide/ioc/diagnostics/environment-tests.html">environment tests</a>.</p><h2 id="adding-lamar-environment-checks"><a class="header-anchor" href="#adding-lamar-environment-checks" aria-hidden="true">#</a> Adding Lamar Environment Checks</h2><p>You can also add Lamar&#39;s container validation and its own environment tests to the <em>Oakton.AspNetCore</em> environment check functionality with the following usage of the <code>IServiceCollection.CheckLamarConfiguration()</code> extension method from <em>Lamar.Diagnostics</em> as shown below in a sample <code>Startup.ConfigureContainer()</code> method:</p><!-- snippet: sample_startup-with-check-lamar-configuration --><p><a id="snippet-sample_startup-with-check-lamar-configuration"></a></p><div class="language-cs"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Startup</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Take in Lamar&#39;s ServiceRegistry instead of IServiceCollection</span>
    <span class="token comment">// as your argument, but fear not, it implements IServiceCollection</span>
    <span class="token comment">// as well</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureContainer</span><span class="token punctuation">(</span><span class="token class-name">ServiceRegistry</span> services<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Supports ASP.Net Core DI abstractions</span>
        services<span class="token punctuation">.</span><span class="token function">AddMvc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        services<span class="token punctuation">.</span><span class="token function">AddLogging</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Also exposes Lamar specific registrations</span>
        <span class="token comment">// and functionality</span>
        services<span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
            s<span class="token punctuation">.</span><span class="token function">TheCallingAssembly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            s<span class="token punctuation">.</span><span class="token function">WithDefaultConventions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        
        <span class="token comment">// This adds Lamar&#39;s validation to the </span>
        <span class="token comment">// Oakton.AspNetCore environment check support</span>
        services<span class="token punctuation">.</span><span class="token function">CheckLamarConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IApplicationBuilder</span> app<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        app<span class="token punctuation">.</span><span class="token function">UseMvc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/lamar/blob/master/src/SampleWebApp/Startup.cs#L16-L47" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_startup-with-check-lamar-configuration" title="Start of snippet">anchor</a></sup><!-- endSnippet --></p><p>Now, when you run the <code>dotnet run -- check-env</code> command for your application, you <em>should</em> see a check for the Lamar container:</p><div class="language-bash"><pre><code>Searching <span class="token string">&#39;Lamar.Diagnostics, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null&#39;</span> <span class="token keyword">for</span> commands
Running Environment Checks
   <span class="token number">1</span>.<span class="token punctuation">)</span> Success: Lamar IoC Service Registrations
All environment checks are good<span class="token operator">!</span>

</code></pre></div></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-fb8d84c6><div class="edit" data-v-fb8d84c6><div class="edit-link" data-v-fb8d84c6 data-v-1ed99556><a class="link" href="https://github.com/JasperFx/lamar/edit/master/docs/guide/ioc/aspnetcore.md" target="_blank" rel="noopener noreferrer" data-v-1ed99556>Suggest changes to this page <svg class="icon outbound icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-1ed99556><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="updated" data-v-fb8d84c6><!----></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><a class="link" href="/lamar/guide/ioc/bootstrapping" data-v-38ede35f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-38ede35f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-38ede35f>Bootstrapping a Container</span></a></div><div class="next" data-v-38ede35f><a class="link" href="/lamar/guide/ioc/blazor" data-v-38ede35f><span class="text" data-v-38ede35f>Integration with Blazor</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-38ede35f><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"21c8165b\",\"guide_index.md\":\"f5cf0bd1\",\"guide_compilation_assembly-generator.md\":\"a7f9768b\",\"guide_compilation_index.md\":\"508f9f1f\",\"guide_compilation_source-writer.md\":\"9a80aff0\",\"guide_ioc_aspnetcore.md\":\"5455d959\",\"guide_ioc_auto-wiring.md\":\"00357b08\",\"guide_ioc_blazor.md\":\"1d00962f\",\"guide_ioc_bootstrapping.md\":\"13dda372\",\"guide_ioc_concepts.md\":\"c450b170\",\"guide_ioc_decorators.md\":\"fabdd25e\",\"guide_ioc_disposing.md\":\"e742a693\",\"guide_ioc_generics.md\":\"51b716ad\",\"guide_ioc_index.md\":\"7085ef56\",\"guide_ioc_injecting-at-runtime.md\":\"cdd5602c\",\"guide_ioc_lambdas.md\":\"f6034342\",\"guide_ioc_lazy-resolution.md\":\"1b941b3b\",\"guide_ioc_lifetime.md\":\"4f885d39\",\"guide_ioc_nested-containers.md\":\"060c864b\",\"guide_ioc_setter-injection.md\":\"b4b3af0d\",\"guide_ioc_working-with-enumerable-types.md\":\"d5c1fc81\",\"guide_compilation_frames_extension-methods.md\":\"174a362c\",\"guide_compilation_frames_frame.md\":\"e923afc7\",\"guide_compilation_frames_index.md\":\"06b3bf18\",\"guide_compilation_frames_injected-fields.md\":\"7db2f0dd\",\"guide_compilation_frames_variables.md\":\"d2365dce\",\"guide_ioc_diagnostics_build-plans.md\":\"b9f9445f\",\"guide_ioc_diagnostics_environment-tests.md\":\"829d1471\",\"guide_ioc_diagnostics_index.md\":\"3d1b79e6\",\"guide_ioc_diagnostics_type-scanning.md\":\"3b311267\",\"guide_ioc_diagnostics_using-the-container-model.md\":\"c13778cf\",\"guide_ioc_diagnostics_validating-container-configuration.md\":\"ae572237\",\"guide_ioc_diagnostics_what-do-i-have.md\":\"5feaa3e9\",\"guide_ioc_registration_attributes.md\":\"e2c58536\",\"guide_ioc_registration_auto-registration-and-conventions.md\":\"b73ac625\",\"guide_ioc_registration_changing-configuration-at-runtime.md\":\"af453770\",\"guide_ioc_registration_configured-instance.md\":\"4dacb260\",\"guide_ioc_registration_constructor-selection.md\":\"e7c0baee\",\"guide_ioc_registration_existing-objects.md\":\"0d1e0a78\",\"guide_ioc_registration_index.md\":\"6faeaef2\",\"guide_ioc_registration_inline-dependencies.md\":\"e720f4bd\",\"guide_ioc_registration_overrides.md\":\"5fc4c1ca\",\"guide_ioc_registration_policies.md\":\"7c0a17a1\",\"guide_ioc_registration_registry-dsl.md\":\"06bd7459\",\"guide_ioc_resolving_get-a-service-by-plugin-type-and-name.md\":\"d916341a\",\"guide_ioc_resolving_get-a-service-by-service-type.md\":\"38e56531\",\"guide_ioc_resolving_get-all-services-by-service-type.md\":\"c6b1226f\",\"guide_ioc_resolving_index.md\":\"7f7f538b\",\"guide_ioc_resolving_requesting-a-concrete-type.md\":\"9c446e86\",\"guide_ioc_resolving_try-getting-an-optional-service-by-service-type-and-name.md\":\"70a3ad85\",\"guide_ioc_resolving_try-getting-an-optional-service-by-service-type.md\":\"034efc01\"}")</script>
    <script type="module" async src="/lamar/assets/app.21b67795.js"></script>
  </body>
</html>